{"version":3,"sources":["webpack:///./../js/app/prize.js"],"names":["Loading","require","MsgBox","weixin","shareObj","title","desc","link","serverPath","imgUrl","winCode","init","done","share","openPrize","bindEvents","show","$","getJSON","data","hide","console","log","success","list","result","prizes","i","length","giftID","luckydraw_gift_id","code","win_code","filter","addClass","info","virtual_gift_code_shop","alert","msg","on","parent","window","location","href","submitExpress","submitShop","String","hasClass","indexOf","siblings","fadeIn","bindAddress","name","val","trim","mobile","address","test","always","fail","cities","cityIpt","html","shopIpt","shopHTML","push","city","append","find","text","shop_id"],"mappings":"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","file":"js/prize.js","sourcesContent":["var Loading = require(\"../components/loading.js\");\r\nvar MsgBox = require(\"../components/msgbox.js\");\r\nvar weixin = require(\"../libs/weixin.js\");\r\n\r\nvar shareObj = {\r\n    title: \"为乐高英雄助力，送丰厚大奖啦！\", // 分享标题\r\n    desc: '每天助力乐高英雄，天天赠送“乐高颗粒”，月末还能抽大奖哦～',\r\n    link: serverPath + \"lego20170726\",\r\n    imgUrl: serverPath + \"html/compaign/lego20170726/images/share.jpg\",\r\n};\r\nvar winCode;\r\nweixin.init().done(() => {\r\n    weixin.share(shareObj, shareObj);\r\n});\r\n\r\nopenPrize();\r\nbindEvents();\r\n\r\nfunction openPrize() {\r\n    Loading.show();\r\n    $.getJSON(serverPath + 'lego20170726/api/prize-list?callback=?').done((data) => {\r\n        Loading.hide();\r\n        console.log(data);\r\n        if(data.success) {\r\n            let list = data.result.list,\r\n                prizes = $(\".prizeList li\");\r\n            for(let i = 0; i < list.length; i++) {\r\n                let giftID = list[i].luckydraw_gift_id,\r\n                    code = list[i].win_code;\r\n                    \r\n                prizes.filter('[data-id=\"' + giftID + '\"]').addClass('on').data('code', code);\r\n                if(giftID == \"298\" || giftID == \"302\") {\r\n                    if(list[i].info) {\r\n                        prizes.filter('[data-id=\"' + giftID + '\"]').addClass('get');\r\n                    }\r\n                    if(list[i].virtual_gift_code_shop) {\r\n                        prizes.filter('[data-id=\"' + giftID + '\"]').addClass('got');\r\n                    }\r\n                } else {\r\n                    if(list[i].info) {\r\n                        prizes.filter('[data-id=\"' + giftID + '\"]').addClass('got');\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            MsgBox.alert(data.msg);\r\n        }\r\n    });\r\n}\r\n\r\nfunction bindEvents() {\r\n    $(\".pop .close, .pop .closeBtn\").on(\"click\", function() {\r\n        $(this).parent().parent().hide();\r\n    });\r\n\r\n    $(\".siteBtn, .pop.submitShop .submitShopPop .close, .pop.submitExpress .submitExpressPop .close, .pop.blocks .close, .pop.finish .close\").on(\"click\", function() {\r\n        window.location.href = serverPath + \"brands/lego\";\r\n    });\r\n\r\n    // $(\".prizeList li:nth-child(1) .btn\").on(\"click\", function() {\r\n    //     window.location.href = 'http://r.intonead.com/card/coupons';\r\n    // });\r\n\r\n    $(\".pop.express .expressPop .submitBtn\").on(\"click\", submitExpress);\r\n\r\n    $(\".pop.shop .shopPop .submitBtn\").on(\"click\", submitShop);\r\n\r\n    $(\".prizeList li .btn\").on(\"click\", function() {\r\n        let giftID = String($(this).parent().data('id'));\r\n\r\n        if(!$(this).parent().hasClass('got') && $(this).parent().hasClass('on')) {\r\n            if(~giftID.indexOf('277')) {\r\n                window.location.href = 'http://r.intonead.com/card/coupons';\r\n            } else {\r\n\r\n                winCode = $(this).parent().data('code');\r\n                if(~giftID.indexOf('298') || ~giftID.indexOf('302')) {\r\n                    if($(this).parent().hasClass('get')) {\r\n                        window.location.href = serverPath + 'lego20170726/exchange';\r\n                    } else {\r\n                        $(\".pop\").hide().siblings(\".pop.shop\").fadeIn();\r\n                    }\r\n                } else {\r\n                    if(!$(this).parent().hasClass('got')) {\r\n                        $(\".pop\").hide().siblings(\".pop.express\").fadeIn();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    bindAddress();\r\n}\r\n\r\nfunction submitExpress() {\r\n    let name = $(\"#nameExpressIpt\").val().trim(),\r\n        mobile = $(\"#mobileExpressIpt\").val().trim(),\r\n        address = $(\"#addressExpressIpt\").val().trim();\r\n    if(!name ||!address || !/^(13|14|15|18|17)\\d{9}$/.test(mobile)) {\r\n        MsgBox.alert(\"请填写正确的领奖信息\");\r\n        return;\r\n    }\r\n    Loading.show();\r\n    $.getJSON(serverPath + 'lego20170726/api/info?callback=?', {\r\n        name: name,\r\n        mobile: mobile,\r\n        address: address,\r\n        winCode: winCode\r\n    }).always(() => {\r\n        Loading.hide();\r\n    }).fail(() => {\r\n        MsgBox.alert(\"网络错误 请重试\");\r\n    }).done((data) => {\r\n        console.log(data);\r\n        if(data.success) {\r\n            $(\".pop\").hide().siblings(\".pop.submitExpress\").fadeIn();\r\n        } else {\r\n            MsgBox.alert(data.msg);\r\n        }\r\n    });\r\n}\r\n\r\nfunction submitShop() {\r\n    let name = $(\"#nameShopIpt\").val().trim(),\r\n        mobile = $(\"#mobileShopIpt\").val().trim(),\r\n        address = $(\"#shopIpt option:selected\").val();\r\n    if(!name ||!address || address == '请选择门店' || !/^(13|14|15|18|17)\\d{9}$/.test(mobile)) {\r\n        MsgBox.alert(\"请填写正确的领奖信息\");\r\n        return;\r\n    }\r\n    Loading.show();\r\n    $.getJSON(serverPath + 'lego20170726/api/info?callback=?', {\r\n        name: name,\r\n        mobile: mobile,\r\n        address: address,\r\n        winCode: winCode\r\n    }).always(() => {\r\n        Loading.hide();\r\n    }).fail(() => {\r\n        MsgBox.alert(\"网络错误 请重试\");\r\n    }).done((data) => {\r\n        console.log(data);\r\n        if(data.success) {\r\n            $(\".pop\").hide().siblings(\".pop.submitShop\").fadeIn();\r\n        } else {\r\n            MsgBox.alert(data.msg);\r\n        }\r\n    });\r\n}\r\n\r\nfunction bindAddress() {\r\n    let cities = [];\r\n    let cityIpt = $(\"#cityIpt\"), html = '<option disabled selected>请选择城市</option>';\r\n    let shopIpt = $(\"#shopIpt\"), shopHTML = '<option disabled selected>请选择门店</option>';\r\n\r\n    $.getJSON(serverPath + 'shop/city?callback=?').done((data) => {\r\n        for(let i = 0; i < data.result.list.length; i++) {\r\n            cities.push(data.result.list);\r\n            html += '<option value=\"' + data.result.list[i].city + '\">' + data.result.list[i].city + '</option>';\r\n        }\r\n        cityIpt.append(html);\r\n        shopIpt.html(shopHTML);\r\n    });\r\n\r\n    cityIpt.on(\"change\", function() {\r\n        Loading.show();\r\n        let city = cityIpt.find(\"option:selected\").text();\r\n        $.getJSON(serverPath + 'shop/list?callback=?', {city: city}).done((data) => {\r\n            Loading.hide();\r\n            shopHTML = '<option disabled selected>请选择门店</option>';\r\n            for(let i = 0; i < data.result.list.length; i++) {\r\n                shopHTML += '<option value=\"' + data.result.list[i].name + ',' + data.result.list[i].shop_id + ',' + data.result.list[i].address + '\">' + data.result.list[i].name + '</option>';\r\n            }\r\n            shopIpt.html(shopHTML);\r\n        });\r\n    });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../js/app/prize.js"],"sourceRoot":""}