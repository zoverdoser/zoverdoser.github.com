{"version":3,"sources":["webpack:///./D:/web/jindouyun/public/compaign/lego20161208/js/app/prize.js"],"names":["require","Loading","Msgbox","prizeCode","adjustShop","show","$","getJSON","serverPath","done","res","hide","Date","alert","console","log","success","prizes","result","prize","i","length","prizeID","luckydraw_gift_id","win_code","eq","addClass","attr","info","virtual_gift_code_shop","name","mobile","address","val","virtual_gift_code","msg","provinceArr","createSelect","getList","str","forEach","obj","province","append","on","shopArr","createList","empty","shop_name","city","shop_id","shop_address","parent","hasClass","window","location","href","fadeIn","split","isFilled","Number","submitInfo","shop","shopID","needAddress","trim","test"],"mappings":"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","file":"js/prize.js","sourcesContent":["import weixin from '../libs/Weixin.js';\r\nrequire(\"../common/WeixinCommon.js\");\r\nvar Loading = require(\"../components/loading.js\");\r\nvar Msgbox = require(\"../libs/msgbox.js\");\r\n\r\nlet prizeCode = null;\r\n\r\nadjustShop();\r\n\r\nLoading.show();\r\n$.getJSON(serverPath + 'lego1208/index/prize').done((res) => {\r\n\tLoading.hide();\r\n    if(+new Date() >= 1483200000000) {\r\n        Msgbox.alert('活动已结束');\r\n    }\r\n\tconsole.log(res);\r\n\tif(res.success) {\r\n\t\tlet prizes = res.result.prize;\r\n\t\tfor(let i = 0; i < prizes.length; i++) {\r\n\t\t\tlet prizeID = prizes[i].luckydraw_gift_id;\r\n\t\t\tif(prizeID == '96') {\r\n\t\t\t\t//拼砌包\r\n                prizeCode = prizes[i].win_code;\r\n\t\t\t\t$(\".prizeTicket\").eq(2).addClass('on');\r\n                $(\".prizeTicket\").eq(2).attr('filled', !!prizes[i].info? 1 : 0);\r\n                if(!!prizes[i].virtual_gift_code_shop) {\r\n                    $(\".prizeTicket\").eq(2).addClass('got');\r\n                }\r\n\t\t\t} else if(prizeID == '95') {\r\n\t\t\t\t//街景\r\n\t\t\t\t$(\".prizeTicket\").eq(0).addClass('on');\r\n                $(\".prizeTicket\").eq(0).attr('code', prizes[i].win_code);\r\n\t\t\t\tif(!!prizes[i].info) {\r\n\t\t\t\t\t$(\".prizeTicket\").eq(0).attr('info', prizes[i].info.name + '|' + prizes[i].info.mobile + '|' + prizes[i].info.address);\r\n\t\t\t\t}\r\n\t\t\t} else if(prizeID == '94') {\r\n\t\t\t\t//优惠券\r\n\t\t\t\t$(\".prizeTicket\").eq(1).addClass('on');\r\n                $(\"#codeIpt\").val(prizes[i].virtual_gift_code);\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\talert(res.msg);\r\n\t}\r\n});\r\n\r\nfunction adjustShop() {\r\n    var provinceArr=[];\r\n    $.getJSON(serverPath + \"api/shop/province\")\r\n    .done(function(res){\r\n        provinceArr=res.result;\r\n        createSelect();\r\n    });\r\n    getList();\r\n\r\n    function createSelect(){\r\n        var str=\"<option selected disabled>请选择</option>\"\r\n        provinceArr.forEach(function(obj){\r\n            str +=\"<option value='\"+obj.province+\"''>\"+obj.province+\"</option>\";\r\n        })\r\n        $(\"#provinceSlct\").append(str);\r\n    }\r\n\r\n    var province;\r\n    $(\"#provinceSlct\").on(\"change\",function(){\r\n        province=$(\"#provinceSlct\").val();\r\n        if(province!=\"\"){\r\n            getList();\r\n        }\r\n        \r\n    })\r\n\r\n    var shopArr;\r\n    function getList(){\r\n        Loading.show();\r\n        $.getJSON(serverPath + \"api/shop\",{province:province})\r\n        .done(function(res){\r\n            shopArr=res.result;\r\n            createList();\r\n            Loading.hide();\r\n        })\r\n    }\r\n    function createList(){\r\n        $(\"#shopSlct\").empty();\r\n        var str=\"<option selected disabled>请选择门店</option>\";\r\n        shopArr.forEach(function(obj){\r\n            str += \"<option val='\"+obj.shop_name+ ', ' + obj.city + ', '+ obj.shop_id + ', ' + obj.shop_address +\"'>\"+obj.shop_name+\"</option>\"\r\n        })\r\n        $(\"#shopSlct\").append(str);\r\n    }\r\n}\r\n\r\n$(\".prizeTicket.coupon .siteBtn\").on(\"click\", function() {\r\n    if($(this).parent().hasClass(\"on\")) {\r\n        window.location.href = 'http://r.intonead.com/site#!/coupon';\r\n    }\r\n});\r\n\r\n$(\".pop.code .codePop .close\").on(\"click\", function() {\r\n    $(\".pop.code\").hide();\r\n});\r\n\r\n$(\".prizeTicket.coupon .showCodeBtn\").on(\"click\", function() {\r\n    if($(this).parent().hasClass(\"on\")) {\r\n        $(\".pop.code\").fadeIn();\r\n    }\r\n});\r\n\r\n$(\".prizeTicket.streetView\").on(\"click\", function() {\r\n    if($(this).hasClass('on')) {\r\n        if($(this).attr(\"info\")) {\r\n            let info = $(this).attr(\"info\").split('|');\r\n            $(\"#nameIpt1\").val(info[0]);\r\n            $(\"#mobileIpt1\").val(info[1]);\r\n            $(\"#addressIpt1\").val(info[2]);\r\n        }\r\n        $(\".pop.streetViewSubmit\").fadeIn();\r\n    }\r\n});\r\n\r\n$(\".prizeTicket.block\").on(\"click\", function() {\r\n    if($(this).hasClass('on') && !$(this).hasClass('got')) {\r\n        let isFilled = Number($(this).attr('filled'));\r\n        if(isFilled) {\r\n            $(\".pop.getBlock\").fadeIn();\r\n        } else {\r\n            $(\".pop.blockSubmit\").fadeIn();\r\n        }\r\n    }\r\n});\r\n\r\n$(\".pop.streetViewSubmit .submitBtn\").on(\"click\", function() {\r\n    submitInfo(true);\r\n});\r\n\r\n$(\".pop.blockSubmit .submitBtn\").on(\"click\", function() {\r\n    submitInfo(false);\r\n});\r\n\r\n$(\".getBtn\").on(\"click\", function() {\r\n    let shop = $(\"#shopIpt\").val();\r\n    if(shop.length) {\r\n        Loading.show();\r\n        $.getJSON(serverPath + 'lego1208/index/prize-get', {win_code: prizeCode, shopID: shop}).done((res) => {\r\n            Loading.hide();\r\n            if(res.success) {\r\n                $(\".prizeTicket\").eq(2).addClass('got');\r\n                Msgbox.alert(\"兑换成功\", function() {\r\n                    $(\".pop.getBlock\").hide();\r\n                });\r\n            } else {\r\n                alert(res.msg);\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\n\r\nfunction submitInfo(needAddress) {\r\n    let name, mobile, address = '', province = '', shop = '', win_code;\r\n    if(needAddress) {\r\n        name = $(\"#nameIpt1\").val().trim();\r\n        mobile = $(\"#mobileIpt1\").val().trim();\r\n        address = $(\"#addressIpt1\").val().trim();\r\n        win_code = $(\".prizeTicket\").eq(0).attr(\"code\");\r\n    } else {\r\n        name = $(\"#nameIpt2\").val().trim();\r\n        mobile = $(\"#mobileIpt2\").val().trim();\r\n        province = $(\"#provinceSlct\").val();\r\n        shop = $(\"#shopSlct\").val();\r\n        win_code = prizeCode;\r\n        address = $(\"#provinceSlct\").val() + ',' + $(\"#shopSlct > option:selected\").attr('val');\r\n    }\r\n    if(!name.length || !/^((13|14|15|18|17)\\d{9})|(170\\d{8})$/.test(mobile) || (needAddress && !address.length)) {\r\n        Msgbox.alert(\"请填写完整正确的领奖信息\");\r\n        return;\r\n    }\r\n    Loading.show();\r\n    $.getJSON(serverPath + 'lego1208/index/user-info', {name: name, mobile: mobile, address: address, win_code: win_code}).done((res) => {\r\n        Loading.hide();\r\n        if(res.success) {\r\n            Msgbox.alert(\"提交成功\", function() {\r\n                $(\".pop.blockSubmit, .pop.streetViewSubmit\").hide();\r\n            });\r\n        } else {\r\n            alert(res.msg);\r\n        }\r\n    });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./D:/web/jindouyun/public/compaign/lego20161208/js/app/prize.js"],"sourceRoot":""}